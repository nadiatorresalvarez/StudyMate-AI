@using StudyMateAI.Client.DTOs.Quiz
@using Size = MudBlazor.Size


<MudDialog>
    <TitleContent>
        <div class="d-flex align-center">
            <MudIcon Icon="@Icons.Material.Filled.Grading" Class="mr-3" />
            <MudText Typo="Typo.h6">Resultados: @Result.QuizTitle</MudText>
        </div>
    </TitleContent>
    <DialogContent>
        <div class="d-flex justify-center align-center pa-4">
            <!-- ✅ CORREGIDO: MudProgressCircular no acepta ChildContent -->
            <div class="position-relative d-flex justify-center align-center mr-6">
                <MudProgressCircular Color="Color.Success" Value="@((int)Result.ScorePercent)" Size="Size.Large" />
                <div class="position-absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
                    <MudText Typo="Typo.h5">@($"{Result.ScorePercent:F0}%")</MudText>
                </div>
            </div>
            <div>
                <MudText Typo="Typo.h6">Puntaje: @Result.CorrectAnswers / @Result.TotalQuestions</MudText>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">¡Sigue estudiando para mejorar!</MudText>
            </div>
        </div>
        
        <MudDivider Class="my-4"/>

        <MudExpansionPanels MultiExpansion="true">
            @foreach (var q in Result.Questions)
            {
                <MudExpansionPanel>
                    <TitleContent>
                        <div class="d-flex align-center">
                            <MudIcon Icon="@(q.IsCorrect ? Icons.Material.Filled.CheckCircle : Icons.Material.Filled.Cancel)" 
                                     Color="@(q.IsCorrect ? Color.Success : Color.Error)" Class="mr-3"/>
                            <MudText>@q.QuestionText</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <MudList T="string">
                            @foreach(var option in q.Options)
                            {
                                if (option == q.CorrectAnswer)
                                {
                                    <MudListItem T="string" Icon="@Icons.Material.Filled.Check" IconColor="Color.Success">
                                        @option (Correcta)
                                    </MudListItem>
                                }
                                else if (option == q.SelectedOption && !q.IsCorrect)
                                {
                                    <MudListItem T="string" Icon="@Icons.Material.Filled.Close" IconColor="Color.Error">
                                        @option (Tu respuesta)
                                    </MudListItem>
                                }
                                else
                                {
                                    <MudListItem T="string">@option</MudListItem>
                                }
                            }
                        </MudList>
                    </ChildContent>
                </MudExpansionPanel>
            }
        </MudExpansionPanels>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close" Color="Color.Primary" Variant="Variant.Filled">Cerrar</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = default!;
    [Parameter] public QuizAttemptResultDto Result { get; set; } = new();

    void Close() => MudDialog.Close(DialogResult.Ok(true));
}